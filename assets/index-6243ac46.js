(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function a(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(t){if(t.ep)return;t.ep=!0;const n=a(t);fetch(t.href,n)}})();const J=document.getElementById("seleccionar-ataque"),S=document.getElementById("reiniciar"),W=document.getElementById("boton-mascota"),Z=document.getElementById("boton-reiniciar");S.style.display="none";const ee=document.getElementById("seleccionar-mascota"),w=document.getElementById("mascota-jugador"),oe=document.getElementById("mascota-enemigo"),x=document.getElementById("vidas-jugador"),te=document.getElementById("vidas-enemigo"),R=document.getElementById("resultado"),ae=document.getElementById("ataques-del-jugador"),ne=document.getElementById("ataques-del-enemigo"),se=document.getElementById("contenedorTarjetas"),ie=document.getElementById("contenedorAtaques"),B=document.getElementById("ver-mapa"),u=document.getElementById("mapa");let P=null,q=null,m=[],$=[],r=[],h=[],_,E,I,A,g,s,O,G=[],U,D,p=0,M=0,L=u.getContext("2d"),j,N=new Image;N.src="https://static.platzi.com/media/tmp/class-files/github/curso-programacion-basica/curso-programacion-basica-77-transmision-coordenadas/programar/mokepon/assets/mokemap.png";let F,v=window.innerWidth-20;const z=850;v>z&&(v=z-20);F=v*600/800;u.width=v;u.height=F;let f=class{constructor(o,a,i,t,n=null){this.id=n,this.nombre=o,this.foto=a,this.vida=i,this.ataques=[],this.ancho=80,this.alto=80,this.x=C(0,u.width-this.ancho),this.y=C(0,u.height-this.alto),this.mapaFoto=new Image,this.mapaFoto.src=t,this.velocidadX=0,this.velocidadY=0}pintarMokepon(){L.drawImage(this.mapaFoto,this.x,this.y,this.ancho,this.alto)}},Y=new f("Hipodoge","https://static.platzi.com/media/tmp/class-files/github/curso-programacion-basica/curso-programacion-basica-60-intro-canvas/programar/mokepon/assets/mokepons_mokepon_hipodoge_attack.png",5,"https://static.platzi.com/media/tmp/class-files/github/curso-programacion-basica/curso-programacion-basica-65-clases-methods/programar/mokepon/assets/hipodoge.png"),X=new f("Capipepo","https://static.platzi.com/media/tmp/class-files/github/curso-programacion-basica/curso-programacion-basica-60-intro-canvas/programar/mokepon/assets/mokepons_mokepon_capipepo_attack.png",5,"https://static.platzi.com/media/tmp/class-files/github/curso-programacion-basica/curso-programacion-basica-65-clases-methods/programar/mokepon/assets/capipepo.png"),Q=new f("Ratigueya","https://static.platzi.com/media/tmp/class-files/github/curso-programacion-basica/curso-programacion-basica-60-intro-canvas/programar/mokepon/assets/mokepons_mokepon_ratigueya_attack.png",5,"https://static.platzi.com/media/tmp/class-files/github/curso-programacion-basica/curso-programacion-basica-65-clases-methods/programar/mokepon/assets/ratigueya.png");const ce=[{nombre:"ðŸ’§",id:"boton-agua"},{nombre:"ðŸ’§",id:"boton-agua"},{nombre:"ðŸ’§",id:"boton-agua"},{nombre:"ðŸ”¥",id:"boton-fuego"},{nombre:"ðŸŒ±",id:"boton-tierra"}];Y.ataques.push(...ce);const re=[{nombre:"ðŸŒ±",id:"boton-tierra"},{nombre:"ðŸŒ±",id:"boton-tierra"},{nombre:"ðŸŒ±",id:"boton-tierra"},{nombre:"ðŸ’§",id:"boton-agua"},{nombre:"ðŸ”¥",id:"boton-fuego"}];X.ataques.push(...re);const de=[{nombre:"ðŸ”¥",id:"boton-fuego"},{nombre:"ðŸ”¥",id:"boton-fuego"},{nombre:"ðŸ”¥",id:"boton-fuego"},{nombre:"ðŸ’§",id:"boton-agua"},{nombre:"ðŸŒ±",id:"boton-tierra"}];Q.ataques.push(...de);m.push(Y,X,Q);function ue(){J.style.display="none",B.style.display="none",m.forEach(e=>{_=`
        <input type="radio" name="mascota" id=${e.nombre} />
        <label class="tarjeta-de-mokepon" for=${e.nombre}>
            <p>${e.nombre}</p>
            <img src=${e.foto} alt=${e.nombre}>
        </label>
        `,se.innerHTML+=_,E=document.getElementById("Hipodoge"),I=document.getElementById("Capipepo"),A=document.getElementById("Ratigueya")}),W.addEventListener("click",pe),Z.addEventListener("click",Ae),le()}function le(){fetch("http://192.168.0.17:8080/unirse").then(function(e){e.ok&&e.text().then(function(o){console.log(o),q=o})})}function pe(){if(E.checked)w.innerHTML=E.id,g=E.id;else if(I.checked)w.innerHTML=I.id,g=I.id;else if(A.checked)w.innerHTML=A.id,g=A.id;else{alert("Selecciona una mascota");return}me(g),ee.style.display="none",ge(g),B.style.display="flex",Le()}function me(e){fetch(`http://192.168.0.17:8080/mokepon/${q}`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({mokepon:e})})}function ge(e){let o;for(let a=0;a<m.length;a++)e===m[a].nombre&&(o=m[a].ataques);he(o)}function he(e){e.forEach(o=>{O=`
        <button id=${o.id} class="boton-de-ataque BAtaque">${o.nombre}</button>
        `,ie.innerHTML+=O}),document.getElementById("boton-fuego"),document.getElementById("boton-agua"),document.getElementById("boton-tierra"),G=document.querySelectorAll(".BAtaque")}function fe(){G.forEach(e=>{e.addEventListener("click",o=>{o.target.textContent==="ðŸ”¥"?(r.push("FUEGO"),console.log(r),e.style.background="#112f58",e.disabled=!0):o.target.textContent==="ðŸ’§"?(r.push("AGUA"),console.log(r),e.style.background="#112f58",e.disabled=!0):(r.push("TIERRA"),console.log(r),e.style.background="#112f58",e.disabled=!0),r.length===5&&be()})})}function be(){fetch(`http://192.168.0.17:8080/mokepon/${q}/ataques`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({ataques:r})}),j=setInterval(ye,50)}function ye(){fetch(`http://192.168.0.17:8080/mokepon/${P}/ataques`).then(function(e){e.ok&&e.json().then(function({ataques:o}){o.length==5&&(h=o,Ee())})})}function ke(e){oe.innerHTML=e.nombre,e.ataques,fe()}function y(e,o){U=r[e],D=h[o]}function Ee(){clearInterval(j);for(let e=0;e<r.length;e++)r[e]===h[e]?(y(e,e),k("EMPATE")):r[e]==="FUEGO"&&h[e]==="TIERRA"||r[e]==="AGUA"&&h[e]==="FUEGO"||r[e]==="TIERRA"&&h[e]==="AGUA"?(y(e,e),k("GANASTE"),p++,x.innerHTML=p):(y(e,e),k("PERDISTE"),M++,te.innerHTML=M);Ie()}function Ie(){p===M?T("Esto fue un empate!!!"):p>M?T("FELICITACIONES! Ganaste :)"):T("Lo siento, perdiste :(")}function k(e){let o=document.createElement("p"),a=document.createElement("p");R.innerHTML=e,o.innerHTML=U,a.innerHTML=D,ae.appendChild(o),ne.appendChild(a)}function T(e){R.innerHTML=e,S.style.display="block"}function Ae(){location.reload()}function C(e,o){return Math.floor(Math.random()*(o-e+1)+e)}function Me(){s.x=s.x+s.velocidadX,s.y=s.y+s.velocidadY,L.clearRect(0,0,u.width,u.height),L.drawImage(N,0,0,u.width,u.height),s.pintarMokepon(),ve(s.x,s.y),$.forEach(function(e){e.pintarMokepon(),He(e)})}function ve(e,o){fetch(`http://192.168.0.17:8080/mokepon/${q}/posicion`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({x:e,y:o})}).then(function(a){a.json().then(function({enemigos:i}){console.log(i),$=i.map(function(t){const n=t.mokepon.nombre||"";let c=null;return n=="Hipodoge"?c=new f("Hipodoge","https://static.platzi.com/media/tmp/class-files/github/curso-programacion-basica/curso-programacion-basica-60-intro-canvas/programar/mokepon/assets/mokepons_mokepon_hipodoge_attack.png",5,"https://static.platzi.com/media/tmp/class-files/github/curso-programacion-basica/curso-programacion-basica-65-clases-methods/programar/mokepon/assets/hipodoge.png",t.id):n=="Capipepo"?c=new f("Capipepo","https://static.platzi.com/media/tmp/class-files/github/curso-programacion-basica/curso-programacion-basica-60-intro-canvas/programar/mokepon/assets/mokepons_mokepon_capipepo_attack.png",5,"https://static.platzi.com/media/tmp/class-files/github/curso-programacion-basica/curso-programacion-basica-65-clases-methods/programar/mokepon/assets/capipepo.png",t.id):n=="Ratigueya"&&(c=new f("Ratigueya","https://static.platzi.com/media/tmp/class-files/github/curso-programacion-basica/curso-programacion-basica-60-intro-canvas/programar/mokepon/assets/mokepons_mokepon_ratigueya_attack.png",5,"https://static.platzi.com/media/tmp/class-files/github/curso-programacion-basica/curso-programacion-basica-65-clases-methods/programar/mokepon/assets/ratigueya.png",t.id)),c.x=t.x,c.y=t.y,c})})})}function qe(){s.velocidadX=5}function je(){s.velocidadX=-5}function we(){s.velocidadY=5}function xe(){s.velocidadY=-5}function V(){s.velocidadX=0,s.velocidadY=0}function Te(e){switch(e.key){case"ArrowUp":xe();break;case"ArrowDown":we();break;case"ArrowLeft":je();break;case"ArrowRight":qe();break}}function Le(){s=Be(),console.log(s,g),j=setInterval(Me,50),window.addEventListener("keydown",Te),window.addEventListener("keyup",V)}function Be(){for(let e=0;e<m.length;e++)if(g===m[e].nombre)return m[e]}function He(e){const o=e.y,a=e.y+e.alto,i=e.x+e.ancho,t=e.x,n=s.y,c=s.y+s.alto,b=s.x+s.ancho,K=s.x;c<o||n>a||b<t||K>i||(V(),clearInterval(j),console.log("Se detecto una colision"),P=e.id,J.style.display="flex",B.style.display="none",ke(e))}window.addEventListener("load",ue);const H=require("express"),_e=require("cors"),l=H();l.use(H.static("public"));l.use(_e());l.use(H.json());const d=[];class Oe{constructor(o){this.id=o}asignarMokepon(o){this.mokepon=o}actualizarPosicion(o,a){this.x=o,this.y=a}asignarAtaques(o){this.ataques=o}}class ze{constructor(o){this.nombre=o}}l.get("/unirse",(e,o)=>{const a=`${Math.random()}`,i=new Oe(a);d.push(i),o.setHeader("Access-Control-Allow-Origin","*"),o.send(a)});l.post("/mokepon/:jugadorId",(e,o)=>{const a=e.params.jugadorId||"",i=e.body.mokepon||"",t=new ze(i),n=d.findIndex(c=>a===c.id);n>=0&&d[n].asignarMokepon(t),console.log(d),console.log(a),o.end()});l.post("/mokepon/:jugadorId/posicion",(e,o)=>{const a=e.params.jugadorId||"",i=e.body.x||0,t=e.body.y||0,n=d.findIndex(b=>a===b.id);n>=0&&d[n].actualizarPosicion(i,t);const c=d.filter(b=>a!==b.id);o.send({enemigos:c})});l.post("/mokepon/:jugadorId/ataques",(e,o)=>{const a=e.params.jugadorId||"",i=e.body.ataques||[],t=d.findIndex(n=>a===n.id);t>=0&&d[t].asignarAtaques(i),o.end()});l.get("/mokepon/:jugadorId/ataques",(e,o)=>{const a=e.params.jugadorId||"",i=d.find(t=>t.id==a);o.send({ataques:i.ataques||[]})});l.listen(8080,()=>{console.log("Servidor funcionando")});
