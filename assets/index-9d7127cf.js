(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function a(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(t){if(t.ep)return;t.ep=!0;const n=a(t);fetch(t.href,n)}})();const B=require("express"),W=require("cors"),l=B();l.use(B.static("public"));l.use(W());l.use(B.json());const d=[];class Z{constructor(o){this.id=o}asignarMokepon(o){this.mokepon=o}actualizarPosicion(o,a){this.x=o,this.y=a}asignarAtaques(o){this.ataques=o}}let ee=class{constructor(o){this.nombre=o}};l.get("/unirse",(e,o)=>{const a=`${Math.random()}`,i=new Z(a);d.push(i),o.setHeader("Access-Control-Allow-Origin","*"),o.send(a)});l.post("/mokepon/:jugadorId",(e,o)=>{const a=e.params.jugadorId||"",i=e.body.mokepon||"",t=new ee(i),n=d.findIndex(c=>a===c.id);n>=0&&d[n].asignarMokepon(t),console.log(d),console.log(a),o.end()});l.post("/mokepon/:jugadorId/posicion",(e,o)=>{const a=e.params.jugadorId||"",i=e.body.x||0,t=e.body.y||0,n=d.findIndex(b=>a===b.id);n>=0&&d[n].actualizarPosicion(i,t);const c=d.filter(b=>a!==b.id);o.send({enemigos:c})});l.post("/mokepon/:jugadorId/ataques",(e,o)=>{const a=e.params.jugadorId||"",i=e.body.ataques||[],t=d.findIndex(n=>a===n.id);t>=0&&d[t].asignarAtaques(i),o.end()});l.get("/mokepon/:jugadorId/ataques",(e,o)=>{const a=e.params.jugadorId||"",i=d.find(t=>t.id==a);o.send({ataques:i.ataques||[]})});l.listen(8080,()=>{console.log("Servidor funcionando")});const J=document.getElementById("seleccionar-ataque"),S=document.getElementById("reiniciar"),oe=document.getElementById("boton-mascota"),te=document.getElementById("boton-reiniciar");S.style.display="none";const ae=document.getElementById("seleccionar-mascota"),w=document.getElementById("mascota-jugador"),ne=document.getElementById("mascota-enemigo"),x=document.getElementById("vidas-jugador"),se=document.getElementById("vidas-enemigo"),R=document.getElementById("resultado"),ie=document.getElementById("ataques-del-jugador"),ce=document.getElementById("ataques-del-enemigo"),re=document.getElementById("contenedorTarjetas"),de=document.getElementById("contenedorAtaques"),H=document.getElementById("ver-mapa"),u=document.getElementById("mapa");let P=null,q=null,m=[],$=[],r=[],h=[],_,E,I,A,g,s,O,G=[],U,D,p=0,M=0,L=u.getContext("2d"),j,N=new Image;N.src="https://static.platzi.com/media/tmp/class-files/github/curso-programacion-basica/curso-programacion-basica-77-transmision-coordenadas/programar/mokepon/assets/mokemap.png";let F,v=window.innerWidth-20;const z=850;v>z&&(v=z-20);F=v*600/800;u.width=v;u.height=F;class f{constructor(o,a,i,t,n=null){this.id=n,this.nombre=o,this.foto=a,this.vida=i,this.ataques=[],this.ancho=80,this.alto=80,this.x=C(0,u.width-this.ancho),this.y=C(0,u.height-this.alto),this.mapaFoto=new Image,this.mapaFoto.src=t,this.velocidadX=0,this.velocidadY=0}pintarMokepon(){L.drawImage(this.mapaFoto,this.x,this.y,this.ancho,this.alto)}}let Y=new f("Hipodoge","https://static.platzi.com/media/tmp/class-files/github/curso-programacion-basica/curso-programacion-basica-60-intro-canvas/programar/mokepon/assets/mokepons_mokepon_hipodoge_attack.png",5,"https://static.platzi.com/media/tmp/class-files/github/curso-programacion-basica/curso-programacion-basica-65-clases-methods/programar/mokepon/assets/hipodoge.png"),X=new f("Capipepo","https://static.platzi.com/media/tmp/class-files/github/curso-programacion-basica/curso-programacion-basica-60-intro-canvas/programar/mokepon/assets/mokepons_mokepon_capipepo_attack.png",5,"https://static.platzi.com/media/tmp/class-files/github/curso-programacion-basica/curso-programacion-basica-65-clases-methods/programar/mokepon/assets/capipepo.png"),Q=new f("Ratigueya","https://static.platzi.com/media/tmp/class-files/github/curso-programacion-basica/curso-programacion-basica-60-intro-canvas/programar/mokepon/assets/mokepons_mokepon_ratigueya_attack.png",5,"https://static.platzi.com/media/tmp/class-files/github/curso-programacion-basica/curso-programacion-basica-65-clases-methods/programar/mokepon/assets/ratigueya.png");const ue=[{nombre:"ðŸ’§",id:"boton-agua"},{nombre:"ðŸ’§",id:"boton-agua"},{nombre:"ðŸ’§",id:"boton-agua"},{nombre:"ðŸ”¥",id:"boton-fuego"},{nombre:"ðŸŒ±",id:"boton-tierra"}];Y.ataques.push(...ue);const le=[{nombre:"ðŸŒ±",id:"boton-tierra"},{nombre:"ðŸŒ±",id:"boton-tierra"},{nombre:"ðŸŒ±",id:"boton-tierra"},{nombre:"ðŸ’§",id:"boton-agua"},{nombre:"ðŸ”¥",id:"boton-fuego"}];X.ataques.push(...le);const pe=[{nombre:"ðŸ”¥",id:"boton-fuego"},{nombre:"ðŸ”¥",id:"boton-fuego"},{nombre:"ðŸ”¥",id:"boton-fuego"},{nombre:"ðŸ’§",id:"boton-agua"},{nombre:"ðŸŒ±",id:"boton-tierra"}];Q.ataques.push(...pe);m.push(Y,X,Q);function me(){J.style.display="none",H.style.display="none",m.forEach(e=>{_=`
        <input type="radio" name="mascota" id=${e.nombre} />
        <label class="tarjeta-de-mokepon" for=${e.nombre}>
            <p>${e.nombre}</p>
            <img src=${e.foto} alt=${e.nombre}>
        </label>
        `,re.innerHTML+=_,E=document.getElementById("Hipodoge"),I=document.getElementById("Capipepo"),A=document.getElementById("Ratigueya")}),oe.addEventListener("click",he),te.addEventListener("click",qe),ge()}function ge(){fetch("http://192.168.0.17:8080/unirse").then(function(e){e.ok&&e.text().then(function(o){console.log(o),q=o})})}function he(){if(E.checked)w.innerHTML=E.id,g=E.id;else if(I.checked)w.innerHTML=I.id,g=I.id;else if(A.checked)w.innerHTML=A.id,g=A.id;else{alert("Selecciona una mascota");return}fe(g),ae.style.display="none",be(g),H.style.display="flex",_e()}function fe(e){fetch(`http://192.168.0.17:8080/mokepon/${q}`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({mokepon:e})})}function be(e){let o;for(let a=0;a<m.length;a++)e===m[a].nombre&&(o=m[a].ataques);ye(o)}function ye(e){e.forEach(o=>{O=`
        <button id=${o.id} class="boton-de-ataque BAtaque">${o.nombre}</button>
        `,de.innerHTML+=O}),document.getElementById("boton-fuego"),document.getElementById("boton-agua"),document.getElementById("boton-tierra"),G=document.querySelectorAll(".BAtaque")}function ke(){G.forEach(e=>{e.addEventListener("click",o=>{o.target.textContent==="ðŸ”¥"?(r.push("FUEGO"),console.log(r),e.style.background="#112f58",e.disabled=!0):o.target.textContent==="ðŸ’§"?(r.push("AGUA"),console.log(r),e.style.background="#112f58",e.disabled=!0):(r.push("TIERRA"),console.log(r),e.style.background="#112f58",e.disabled=!0),r.length===5&&Ee()})})}function Ee(){fetch(`http://192.168.0.17:8080/mokepon/${q}/ataques`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({ataques:r})}),j=setInterval(Ie,50)}function Ie(){fetch(`http://192.168.0.17:8080/mokepon/${P}/ataques`).then(function(e){e.ok&&e.json().then(function({ataques:o}){o.length==5&&(h=o,Me())})})}function Ae(e){ne.innerHTML=e.nombre,e.ataques,ke()}function y(e,o){U=r[e],D=h[o]}function Me(){clearInterval(j);for(let e=0;e<r.length;e++)r[e]===h[e]?(y(e,e),k("EMPATE")):r[e]==="FUEGO"&&h[e]==="TIERRA"||r[e]==="AGUA"&&h[e]==="FUEGO"||r[e]==="TIERRA"&&h[e]==="AGUA"?(y(e,e),k("GANASTE"),p++,x.innerHTML=p):(y(e,e),k("PERDISTE"),M++,se.innerHTML=M);ve()}function ve(){p===M?T("Esto fue un empate!!!"):p>M?T("FELICITACIONES! Ganaste :)"):T("Lo siento, perdiste :(")}function k(e){let o=document.createElement("p"),a=document.createElement("p");R.innerHTML=e,o.innerHTML=U,a.innerHTML=D,ie.appendChild(o),ce.appendChild(a)}function T(e){R.innerHTML=e,S.style.display="block"}function qe(){location.reload()}function C(e,o){return Math.floor(Math.random()*(o-e+1)+e)}function je(){s.x=s.x+s.velocidadX,s.y=s.y+s.velocidadY,L.clearRect(0,0,u.width,u.height),L.drawImage(N,0,0,u.width,u.height),s.pintarMokepon(),we(s.x,s.y),$.forEach(function(e){e.pintarMokepon(),ze(e)})}function we(e,o){fetch(`http://192.168.0.17:8080/mokepon/${q}/posicion`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({x:e,y:o})}).then(function(a){a.json().then(function({enemigos:i}){console.log(i),$=i.map(function(t){const n=t.mokepon.nombre||"";let c=null;return n=="Hipodoge"?c=new f("Hipodoge","https://static.platzi.com/media/tmp/class-files/github/curso-programacion-basica/curso-programacion-basica-60-intro-canvas/programar/mokepon/assets/mokepons_mokepon_hipodoge_attack.png",5,"https://static.platzi.com/media/tmp/class-files/github/curso-programacion-basica/curso-programacion-basica-65-clases-methods/programar/mokepon/assets/hipodoge.png",t.id):n=="Capipepo"?c=new f("Capipepo","https://static.platzi.com/media/tmp/class-files/github/curso-programacion-basica/curso-programacion-basica-60-intro-canvas/programar/mokepon/assets/mokepons_mokepon_capipepo_attack.png",5,"https://static.platzi.com/media/tmp/class-files/github/curso-programacion-basica/curso-programacion-basica-65-clases-methods/programar/mokepon/assets/capipepo.png",t.id):n=="Ratigueya"&&(c=new f("Ratigueya","https://static.platzi.com/media/tmp/class-files/github/curso-programacion-basica/curso-programacion-basica-60-intro-canvas/programar/mokepon/assets/mokepons_mokepon_ratigueya_attack.png",5,"https://static.platzi.com/media/tmp/class-files/github/curso-programacion-basica/curso-programacion-basica-65-clases-methods/programar/mokepon/assets/ratigueya.png",t.id)),c.x=t.x,c.y=t.y,c})})})}function xe(){s.velocidadX=5}function Te(){s.velocidadX=-5}function Le(){s.velocidadY=5}function Be(){s.velocidadY=-5}function V(){s.velocidadX=0,s.velocidadY=0}function He(e){switch(e.key){case"ArrowUp":Be();break;case"ArrowDown":Le();break;case"ArrowLeft":Te();break;case"ArrowRight":xe();break}}function _e(){s=Oe(),console.log(s,g),j=setInterval(je,50),window.addEventListener("keydown",He),window.addEventListener("keyup",V)}function Oe(){for(let e=0;e<m.length;e++)if(g===m[e].nombre)return m[e]}function ze(e){const o=e.y,a=e.y+e.alto,i=e.x+e.ancho,t=e.x,n=s.y,c=s.y+s.alto,b=s.x+s.ancho,K=s.x;c<o||n>a||b<t||K>i||(V(),clearInterval(j),console.log("Se detecto una colision"),P=e.id,J.style.display="flex",H.style.display="none",Ae(e))}window.addEventListener("load",me);
